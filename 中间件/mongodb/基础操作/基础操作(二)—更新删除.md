# 基础操作(二)——更新删除

## 1. 更新文档

mongodb提供了更新操作文档的操作方法，在示例中主要使用了集中常用的方法：

- [`db.collection.updateOne(<filter>, <update>, <options>)`](https://www.mongodb.com/docs/v4.4/reference/method/db.collection.updateOne/#mongodb-method-db.collection.updateOne)

- [`db.collection.updateMany(<filter>, <update>, <options>)`](https://www.mongodb.com/docs/v4.4/reference/method/db.collection.updateMany/#mongodb-method-db.collection.updateMany)

- [`db.collection.replaceOne(<filter>, <update>, <options>)`](https://www.mongodb.com/docs/v4.4/reference/method/db.collection.replaceOne/#mongodb-method-db.collection.replaceOne)

在示例测试的过程中，主要会用到一下数据，可以通过插入的方式执行：

```shell
db.inventory.insertMany( [
   { item: "canvas", qty: 100, size: { h: 28, w: 35.5, uom: "cm" }, status: "A" },
   { item: "journal", qty: 25, size: { h: 14, w: 21, uom: "cm" }, status: "A" },
   { item: "mat", qty: 85, size: { h: 27.9, w: 35.5, uom: "cm" }, status: "A" },
   { item: "mousepad", qty: 25, size: { h: 19, w: 22.85, uom: "cm" }, status: "P" },
   { item: "notebook", qty: 50, size: { h: 8.5, w: 11, uom: "in" }, status: "P" },
   { item: "paper", qty: 100, size: { h: 8.5, w: 11, uom: "in" }, status: "D" },
   { item: "planner", qty: 75, size: { h: 22.85, w: 30, uom: "cm" }, status: "D" },
   { item: "postcard", qty: 45, size: { h: 10, w: 15.25, uom: "cm" }, status: "A" },
   { item: "sketchbook", qty: 80, size: { h: 14, w: 21, uom: "cm" }, status: "A" },
   { item: "sketch pad", qty: 95, size: { h: 22.85, w: 30.5, uom: "cm" }, status: "A" }
] );
```

### 1.1 在集合中更新文档

mongodb本身提供了很多的操作用于更新，具体的更新语法为：

```shell
{
  <update operator>: { <field1>: <value1>, ... },
  <update operator>: { <field2>: <value2>, ... },
  ...
}
```

### 1.2 更新单个文档

mongodb中，可以使用`db.collection.updateOne`方法实现单个文档更新，在更新操作中，可以设置：

- 设置过滤器，确定那些数据将会被更新

- 更新操作，确定那些属性被更新，更新的新值

- 设置数据被更新的时间

例如：将`item=paper的文档中，将size.ucom更新为cm, status更新为P`, 则对应的更新为:

```shell
db.inventory.updateOne(
   { item: "paper" },
   {
     $set: { "size.uom": "cm", status: "P" },
     $currentDate: { lastModified: true }
   }
)
```

更新操作完成后，则返回的结果信息为:

```json
{
  acknowledged: true,
  insertedId: null,
  matchedCount: 1,
  modifiedCount: 1,
  upsertedCount: 0
}

```

更新语句当中，主要包含了两个操作符：

- 通过`$set`操作符设置`size.uom的值为cm, status的值为P`

- `$currentDate`操作符用于更新`lastModified`属性的值为当前时间，如果该属性不存在，则创建`lastModified`属性
