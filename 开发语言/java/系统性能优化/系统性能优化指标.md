# 系统性能优化指标

## 那些参考因素可以提现系统的性能

1. `CPU`

有的应用需要大量计算，他们会长时间，不间断地占用CPU资源，导致其他资源无法争夺到CPU而相应缓慢，从而带来系统性能问题。

- 例如:
  - 代码递归导致的无线循环
  - 正则表达式引起的回溯
  - JVM频繁的`FULL GC`
  - 多线程造成的大量上下文切换等

2. `内存`

Java程序一般通过JVM对内存进行分配管理，主要是用JVM中的堆内存来存储Java创建的对象。系统堆内存的读写速度非常快，所以基本不存在读写瓶颈。但是由于内存成本要被磁盘高，相比磁盘，内存的存储空间又非常有限。所以当内存空间被占满，对象无法回收时，就会导致`内存溢出`, `内存泄露`等问题

3. `磁盘I/O`

磁盘相比内存来说，存储空间要大很多，但磁盘I/O读写的速度要被内存慢，虽然目前引入的`SSD`固态硬盘已经有所优化，但仍然无法与内存的读写速度相提并论

4. `网络`

网络对于系统性能来说，起着至关重要的作用。对于传输数据比较大，或者时并发量比较大的系统，网络就很容易成为性能瓶颈。

5. `异常`

Java应用中，抛出异常需要构建异常栈，对异常进行捕获和处理，这个过程非常消耗系统性能。如果在高并发的情况下引发一场，持续地进行异常处理，那么系统的性能就会明显的受到影响。

6. `数据库`

大部分系统都会用到数据库，而数据库的操作往往是设计到磁盘I/O的读写。大量的数据库读写操作，会导致磁盘I/O性能瓶颈，进而导致数据库操作的延迟性。对于大量数据库读写操作的系统来说，数据库的性能优化是整个系统的核心。

7. `锁竞争`

在并发编程中，我们经常需要多个线程，共享读写同一个资源，这个时候为了保持数据的原子性，我们就会用到锁。锁的使用可能会带来上下文切换，从而给系统带来性能开销。在JDK1.6之后，Java为了降低锁竞争带来的上下文切换，对JVM内部锁已经做了多次优化。例如: `偏向锁`, `自旋锁`, `轻量级锁`, `锁粗化`, `锁消除`



## 衡量系统性能指标

1. `响应时间`

响应时间时衡量系统性能的重要指标之一，响应时间越短，性能越好。一般一个接口的响应时间是在`毫秒级`

- 数据库响应时间：数据库操作所消耗的时间，往往是整个请求中最耗时的
- 服务端响应时间: 服务端包括`Nginx`分发的请求嗦消耗的时间以及服务端程序执行所消耗的时间
- 网络响应时间：这是网络传输时，网络硬件需要对传输的请求进行解析等操作所消耗的时间
- 客户端响应时间: 对于普通的`Web`, `App`客户端来说，消耗时间时可以忽略不计的。

2. `吞吐量`

在测试中，我们往往会比较注重系统接口的`TPS（每秒事务处理量）`, 因为TPS提现了接口的性能，TPS越大，性能越好。在系统中，我们也可以吧吞吐量自下而上地分为两种: `磁盘吞吐量`和`网络吞吐量`.

- `磁盘吞吐量`
  - `IOPS(Input/Output Per Second)`, 即每秒的输入输出量，这种是指单位时间内系统能处理的I/O请求数量，I/O请求通常为读或写数据操作请求，关注的是随机读写性能。适用于随机读写频繁的应用: `小文件存储`, `OLTP数据库`, `右键服务器`
  - `数据吞吐量` 这种是指单位时间内可以成功传输的数据量。对于大量顺序读写频繁的应用，传输大量连续数据。
- `网络吞吐量`
  - 这是指网络传输时没有帧丢失的情况下，设备能够接受的最大数据速率。网络吞吐量不仅仅跟带宽有关系，还跟`CPU的处理能力`, `网卡`,`防火墙`,`外部接口`以及`I/O`等紧密关联，而吞吐量的大小主要由`网卡的处理能力`, `内部程序算法以及带宽大小决定`

3. `计算机资源分配使用率`

通常由`CPU占用率`, `内存使用率`, `磁盘I/O`, `网络I/O`来表示资源使用率。



4. `负载承受能力`

当系统压力上升时，你可以观察，系统响应时间的上升曲线是否平缓。这项指标能够直观地反馈给你，系统所能承受的负载压力极限。