# 性能优化策略

## 性能测试攻略

### 维基准性能测试

微基准性能测试可以精准定位到某个模块或者某个方法的性能问题，特别适合做一个功能模块或者一个方法在不同实现下的性能对比。

### 宏基准性能测试

宏基准性能测试是一个综合测试，需要考虑到`测试环境`, `测试场景`, `测试目标`

#### 测试环境

对于测试环境而言，我们需要模拟先上的真实环境。

#### 测试场景

我们需要确定在测试某个接口时，是否有其他业务接口同时也在平行运行，造成干扰。如果有，请重视，因为一旦忽视了这种干扰，测试接口就会出现偏差。

#### 测试目标

我们性能测试是要有目标的，这里我们可以通过`吞吐量`以及`响应时间`来衡量系统是否达标。

如果不达标，就进行优化；

达标，就继续加大测试的并发数，探底接口的`TPS`

除了测试接口的吞吐量和响应时间以外，我们还需要循环测试可能导致性能问题的接口，观察各个服务器`CPU`,`内存`, `I/O`使用率的变化。



## 注意问题

### 热身问题

在Java编译语言环境中，`.java`文件编译成为`.class`文件后，机器还是无法直接运行`.class`文件中的字节码，需要通过解释器将字节码转换成本地机器码才能运行。为了节约内存和执行效率，代码最初被执行时，解释器就会率先解释执行这段代码。

​    随着代码被执行的次数增增多，当虚拟机发现某个方法或代码运行得特别频繁时，就汇把这些代码认定为`热点代码(Hot Spot Code)`,. 为了提高热点代码的执行效率，在运行时，虚拟机将会通过`即时编译器(JIT compiler, just-in-time compiler)`把这些代码编译成语本地平台相关的机器码，并进行各层次的优化，然后存储在内存中，之后每次运行代码时，直接从内存中获取即可。



### 性能测试结果不稳定

我们在测试的时候，伴随着很多不稳定因素，比如`机器其他进程的影响`，`网络波动`, `以及每个阶段JVM垃圾回收的不同`等等。

一般情况下，可以采取多次测试，取平均值的方式， 保证平均值在合理范围之内。



### 多JVM情况下的影响

如果我们服务器有多个Java应用服务，部署在不同的tomcat下，这就意味着我们的服务器有多个JVM, 任意一个JVM都有整个系统的资源使用权。



