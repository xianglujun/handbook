# 复制
在Redis中, 用户可以通过执行`SLAVEOF`命令或者设置`slaveof`选项, 让一个服务器去复制另一个服务器
- 被赋值的服务器叫做主服务器
- 对主服务器进行赋值的服务器则被称为从服务器

进行负值中的主从服务器双方的数据库将保存相同的数据， 概念上将这种现象称作"数据库状态一致", 或者简称"一致"

## 旧版复制功能的实现
旧版功能主要是指`Redis 2.8`以前版本, 在复制的时候会出现一些低效的情况

Redis的复制功能分为`同步(sync)`和`命令传播(command propagate)`两个操作:
- 同步操作用于将从服务器的数据库状态更新至主服务器当前所处的数据库状态
- 命令传播操作则用于在主服务器的数据库状态被修改, 导致从服务器的数据库状态出现不一致时, 让主服务器的数据库重回到一致状态。

### 同步
当客户端想服务器发送SALVEOF命令, 要求从服务器复制主服务器时, 从服务器首先需要执行同步操作, 也即是, 将从服务器状态更新至主服务器当前所处的数据库状态。

从服务器对主服务器的同步操作需要通过向主服务器发送`SYNC`命令来完成,以下是`SYNC`命令的执行步骤：
- 从服务器向主服务器发送`SYNC`命令
- 收到SYNC命令的主服务器执行BGSAVE命令, 在后台生成一个RDB文件, 并使用一个缓冲区记录从现在开始执行的所有命令
- 当主服务器的`BGSAVE`命令执行完毕时, 主服务器将`BGSAVE`命令生成的RDB文件发送给从服务器, 从服务器接收并载入这个RDB文件, 将自己的数据状态更新至主服务器执行BGSAVE命令时的数据库状态
- 主服务器将记录在缓冲区里面的所有鞋命令发送给从服务器, 从服务器执行这些写命令, 将自己的数据库状态更新至主服务器数据库当前所处的状态。
